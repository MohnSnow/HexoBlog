<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="码农"><title>IntelliJ IDEA运行Tomcat源码环境的搭建 | Jason的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">IntelliJ IDEA运行Tomcat源码环境的搭建</h1><a id="logo" href="/.">Jason的博客</a><p class="description">我捉到了一只蟋蟀</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-male"> 关于</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/book/"><i class="fa fa-book"> 书单</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">IntelliJ IDEA运行Tomcat源码环境的搭建</h1><div class="post-meta">May 29, 2019<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#总览"><span class="toc-number">1.</span> <span class="toc-text">总览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一-创建项目目录结构"><span class="toc-number">2.</span> <span class="toc-text">一.创建项目目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二-下载Tomcat二进制分发包"><span class="toc-number">3.</span> <span class="toc-text">二.下载Tomcat二进制分发包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三-下载Tomcat源代码"><span class="toc-number">4.</span> <span class="toc-text">三.下载Tomcat源代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#四-catalina-tomcat-source文件夹中创建pom-xml文件"><span class="toc-number">5.</span> <span class="toc-text">四.catalina-tomcat-source文件夹中创建pom.xml文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#五-catalina-study文件夹中创建根pom-xml文件"><span class="toc-number">6.</span> <span class="toc-text">五.catalina-study文件夹中创建根pom.xml文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#六-用IntelliJ-IDEA-打开项目根目录的pom-xml"><span class="toc-number">7.</span> <span class="toc-text">六.用IntelliJ IDEA 打开项目根目录的pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#七-运行Tomcat"><span class="toc-number">8.</span> <span class="toc-text">七.运行Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#八-参考文档"><span class="toc-number">9.</span> <span class="toc-text">八.参考文档</span></a></li></ol></div></div><div class="post-content"><h4 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h4><p>在进行搭建之前，我们首先来说一下总体的思路。<br>我们知道Tomcat运行的时候，一部分是源代码编译以后的可运行的Jar,另外一部分则是运行时的环境<br>（也就是我们从官方下载下来的二进制分发包中的一系列的配置文件以及目录结构，说的更直白点就是CATALINA_HOME环境变量指定的目录）,<br><a id="more"></a><br>本文对于第一部分采用IntelliJ IDEA 运行tomcat-8.5.41 tag的源代码，<br>而对于第二部分运行环境，我们则直接采用tomcat-8.5.41的二进制分发包。明白了上述的思路以后，咋们就来一步步的搭建吧。<br>首先咋们来看看搭建完成以后的总体的目录结构，然后再一步步的去分解搭建过程。笔者搭建完以后，最终的运行结构如下图所示：<br><img src="/2019/05/29/35Tomcat源码学习/last.png" alt="最终效果"><br>下面分别解释一下上图工程结构中涉及到的文件和目录：</p>
<ol>
<li>.idea和tomcat-study.iml是IntelliJ IDEA的文件，如果你用Eclipse的话不会存在这两个东东 。</li>
<li>catalina-home是从官方下载的8.5.41的二进制分发包解压后的目录。</li>
<li>target是Maven编译项目以后生成的文件夹，熟悉Maven的读者应该很熟悉此目录。</li>
<li>tomcat-8.5.41-sourcecode是从Tomcat 官方仓库 下载的tags的源代码，或点此下载tomcat8.5.41源码。</li>
<li>pom.xml是Maven的配置文件,此工程中有两个pom.xml，这里运用了Maven聚合的特性。</li>
<li>了解了最终的结构以后，咋们就来一步步的搭建它吧。<h4 id="一-创建项目目录结构"><a href="#一-创建项目目录结构" class="headerlink" title="一.创建项目目录结构"></a>一.创建项目目录结构</h4>本文假设我们将项目放在 /Users/MengDexin/workspace/apache 目录中。<br>首先创建：tomcat-study 文件夹</li>
</ol>
<h4 id="二-下载Tomcat二进制分发包"><a href="#二-下载Tomcat二进制分发包" class="headerlink" title="二.下载Tomcat二进制分发包"></a>二.下载Tomcat二进制分发包</h4><p>也就是：apache-tomcat-8.5.41.zip<br>解压重命名为：catalina-home<br>然后把这个文件夹移到tomcat-study 文件夹中</p>
<h4 id="三-下载Tomcat源代码"><a href="#三-下载Tomcat源代码" class="headerlink" title="三.下载Tomcat源代码"></a>三.下载Tomcat源代码</h4><p>也就是：apache-tomcat-8.5.41-src.zip<br>解压重命名为：catalina-tomcat-source<br>然后把这个文件夹移到tomcat-study 文件夹中</p>
<h4 id="四-catalina-tomcat-source文件夹中创建pom-xml文件"><a href="#四-catalina-tomcat-source文件夹中创建pom-xml文件" class="headerlink" title="四.catalina-tomcat-source文件夹中创建pom.xml文件"></a>四.catalina-tomcat-source文件夹中创建pom.xml文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></div><div class="line">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</div><div class="line"> </div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>catalina-tomcat-source<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>catalina-tomcat-source<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"> </div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.easymock<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easymock<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.ant<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ant<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxrpc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jdt.core.compiler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ecj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>test<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="五-catalina-study文件夹中创建根pom-xml文件"><a href="#五-catalina-study文件夹中创建根pom-xml文件" class="headerlink" title="五.catalina-study文件夹中创建根pom.xml文件"></a>五.catalina-study文件夹中创建根pom.xml文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.imtiger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>Tomcat 7.0 Study<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">modules</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">module</span>&gt;</span>tomcat-7.0.75-sourcecode<span class="tag">&lt;/<span class="name">module</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="六-用IntelliJ-IDEA-打开项目根目录的pom-xml"><a href="#六-用IntelliJ-IDEA-打开项目根目录的pom-xml" class="headerlink" title="六.用IntelliJ IDEA 打开项目根目录的pom.xml"></a>六.用IntelliJ IDEA 打开项目根目录的pom.xml</h4><p>这一步需要注意，要用IDEA 打开项目根目录的pom.xml文件</p>
<h4 id="七-运行Tomcat"><a href="#七-运行Tomcat" class="headerlink" title="七.运行Tomcat"></a>七.运行Tomcat</h4><p>Edit Configurations -&gt; 点击+号 -&gt; Application  开始相关配置：<br>Main Class: org.apache.catalina.startup.Bootstrap<br>BM Options:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-Dcatalina.home=catalina-home </div><div class="line">-Dcatalina.base=catalina-home </div><div class="line">-Djava<span class="selector-class">.endorsed</span><span class="selector-class">.dirs</span>=catalina-home/endorsed </div><div class="line">-Djava<span class="selector-class">.io</span><span class="selector-class">.tmpdir</span>=catalina-home/temp </div><div class="line">-Djava<span class="selector-class">.util</span><span class="selector-class">.logging</span><span class="selector-class">.manager</span>=org<span class="selector-class">.apache</span><span class="selector-class">.juli</span><span class="selector-class">.ClassLoaderLogManager</span> </div><div class="line">-Djava<span class="selector-class">.util</span><span class="selector-class">.logging</span><span class="selector-class">.config</span><span class="selector-class">.file</span>=catalina-home/conf/logging.properties</div></pre></td></tr></table></figure></p>
<p>配置好的页面如下：<br><img src="/2019/05/29/35Tomcat源码学习/jiemian.png" alt="界面"><br>这时候会出现一个报错：<br><img src="/2019/05/29/35Tomcat源码学习/error.png" alt="错误"><br>需要增加这个测试Util类<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * Licensed to the Apache Software Foundation (ASF) under one or more</div><div class="line"> * contributor license agreements.  See the NOTICE file distributed with</div><div class="line"> * this work for additional information regarding copyright ownership.</div><div class="line"> * The ASF licenses this file to You under the Apache License, Version 2.0</div><div class="line"> * (the "License"); you may not use this file except in compliance with</div><div class="line"> * the License.  You may obtain a copy of the License at</div><div class="line"> *</div><div class="line"> *     http://www.apache.org/licenses/LICENSE-2.0</div><div class="line"> *</div><div class="line"> * Unless required by applicable law or agreed to in writing, software</div><div class="line"> * distributed under the License is distributed on an "AS IS" BASIS,</div><div class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div class="line"> * See the License for the specific language governing permissions and</div><div class="line"> * limitations under the License.</div><div class="line"> */</div><div class="line"><span class="keyword">package</span> util;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Locale;</div><div class="line"><span class="keyword">import</span> java.util.StringTokenizer;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Processes a cookie header and attempts to obfuscate any cookie values that</div><div class="line"> * represent session IDs from other web applications. Since session cookie names</div><div class="line"> * are configurable, as are session ID lengths, this filter is not expected to</div><div class="line"> * be 100% effective.</div><div class="line"> *</div><div class="line"> * It is required that the examples web application is removed in security</div><div class="line"> * conscious environments as documented in the Security How-To. This filter is</div><div class="line"> * intended to reduce the impact of failing to follow that advice. A failure by</div><div class="line"> * this filter to obfuscate a session ID or similar value is not a security</div><div class="line"> * vulnerability. In such instances the vulnerability is the failure to remove</div><div class="line"> * the examples web application.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> class CookieFilter &#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> OBFUSCATED = <span class="string">"[obfuscated]"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> CookieFilter() &#123;</div><div class="line">        <span class="comment">// Hide default constructor</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="built_in">filter</span>(<span class="keyword">String</span> cookieHeader, <span class="keyword">String</span> sessionId) &#123;</div><div class="line"></div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(cookieHeader.length());</div><div class="line"></div><div class="line">        <span class="comment">// Cookie name value pairs are ';' separated.</span></div><div class="line">        <span class="comment">// Session IDs don't use ; in the value so don't worry about quoted</span></div><div class="line">        <span class="comment">// values that contain ;</span></div><div class="line">        StringTokenizer st = <span class="keyword">new</span> StringTokenizer(cookieHeader, <span class="string">";"</span>);</div><div class="line"></div><div class="line">        <span class="built_in">boolean</span> first = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span> (st.hasMoreTokens()) &#123;</div><div class="line">            <span class="keyword">if</span> (first) &#123;</div><div class="line">                first = <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                sb.<span class="built_in">append</span>(<span class="string">';'</span>);</div><div class="line">            &#125;</div><div class="line">            sb.<span class="built_in">append</span>(filterNameValuePair(st.nextToken(), sessionId));</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> filterNameValuePair(<span class="keyword">String</span> input, <span class="keyword">String</span> sessionId) &#123;</div><div class="line">        <span class="built_in">int</span> i = input.indexOf(<span class="string">'='</span>);</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> input;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">String</span> name = input.substring(<span class="number">0</span>, i);</div><div class="line">        <span class="keyword">String</span> value = input.substring(i + <span class="number">1</span>, input.length());</div><div class="line"></div><div class="line">        <span class="keyword">return</span> name + <span class="string">"="</span> + <span class="built_in">filter</span>(name, value, sessionId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="built_in">filter</span>(<span class="keyword">String</span> cookieName, <span class="keyword">String</span> cookieValue, <span class="keyword">String</span> sessionId) &#123;</div><div class="line">        <span class="keyword">if</span> (cookieName.toLowerCase(Locale.ENGLISH).contains(<span class="string">"jsessionid"</span>) &amp;&amp;</div><div class="line">                (sessionId == <span class="keyword">null</span> || !cookieValue.contains(sessionId))) &#123;</div><div class="line">            cookieValue = OBFUSCATED;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cookieValue;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这时候就可以起来了</p>
<h4 id="八-参考文档"><a href="#八-参考文档" class="headerlink" title="八.参考文档"></a>八.参考文档</h4><ul>
<li><a href="http://www.tuicool.com/articles/Rz6Fnyf" target="_blank" rel="external">http://www.tuicool.com/articles/Rz6Fnyf</a></li>
<li><a href="http://www.jb51.net/article/95120.htm" target="_blank" rel="external">http://www.jb51.net/article/95120.htm</a></li>
<li><a href="http://blog.csdn.net/catontower/article/details/8559623" target="_blank" rel="external">http://blog.csdn.net/catontower/article/details/8559623</a></li>
<li><a href="http://www.suiyiwen.com/question/4411" target="_blank" rel="external">http://www.suiyiwen.com/question/4411</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://www.biubiu1024.com/2019/05/29/35Tomcat源码学习/" data-id="cjw95oxb3002i6gxwv6shwr2s" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Tomcat/">Tomcat</a></div><div class="post-nav"><a href="/2019/01/29/34够级规则/" class="next">够级规则【王虎帝国专属】</a></div><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>此文有用? 求鼓励!<br></div></div><div id="donate_guide" class="donate_bar center hidden"><img src="https://biubiu1024-1256167492.cos.ap-shanghai.myqcloud.com/WX20190129-201932%402x.png?q-sign-algorithm=sha1&amp;q-ak=AKIDJqH44bvFne65BDOmMrZ4u2KHbiPfG6i5&amp;q-sign-time=1548764396;1548766196&amp;q-key-time=1548764396;1548766196&amp;q-header-list=&amp;q-url-param-list=&amp;q-signature=35fada0e6b1be55ee0667d78dce984c1e40c73c1&amp;x-cos-security-token=e14b5e2b8f7bd68d769b382adb1412932f452ea610001" title="微信打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://www.biubiu1024.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Book/">Book</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Guava/">Guava</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Temp/">Temp</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客技术/">博客技术</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/缓存/">缓存</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/职业规划/">职业规划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Book/" style="font-size: 15px;">Book</a> <a href="/tags/Temp/" style="font-size: 15px;">Temp</a> <a href="/tags/面试-Java/" style="font-size: 15px;">面试 Java</a> <a href="/tags/Java-JVM-虚拟机/" style="font-size: 15px;">Java JVM 虚拟机</a> <a href="/tags/Java-Guava/" style="font-size: 15px;">Java Guava</a> <a href="/tags/Java-Paxos-Zookeeper/" style="font-size: 15px;">Java Paxos Zookeeper</a> <a href="/tags/Tech/" style="font-size: 15px;">Tech</a> <a href="/tags/Java-专业术语/" style="font-size: 15px;">Java 专业术语</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/缓存-架构/" style="font-size: 15px;">缓存 架构</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/游戏/" style="font-size: 15px;">游戏</a> <a href="/tags/Java-对比/" style="font-size: 15px;">Java 对比</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Paxos/" style="font-size: 15px;">Paxos</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a> <a href="/tags/Java-面试/" style="font-size: 15px;">Java 面试</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/05/29/35Tomcat源码学习/">IntelliJ IDEA运行Tomcat源码环境的搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/29/34够级规则/">够级规则【王虎帝国专属】</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/17/33限流算法/">限流算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/32java-web会话管理/">java web会话管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/31git-ignore/">git ignore 文件解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/30IntegerCache-ByteCache-CharacterCache-LongCache-ShortCache/">IntegerCache ByteCache CharacterCache LongCache ShortCache</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/13/29ni真的了解TCP三次握手么？/">ni真的了解TCP三次握手么？</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/28POM文件详解/">POM文件详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/27/27web-xml详解/">web.xml详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/26Java面试题/">Java面试题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.jianshu.com/u/90ab66c248e6" title="占小狼" target="_blank">占小狼</a><ul></ul><a href="http://calvin1978.blogcn.com/" title="江南白衣" target="_blank">江南白衣</a><ul></ul><a href="http://coolshell.cn/" title="酷壳" target="_blank">酷壳</a><ul></ul><a href="http://colobu.com/" title="鸟窝" target="_blank">鸟窝</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Jason的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?10423309";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>