<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="码农"><title>JAVA反射详解和优化 | Jason的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JAVA反射详解和优化</h1><a id="logo" href="/.">Jason的博客</a><p class="description">我捉到了一只蟋蟀</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-male"> 关于</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/book/"><i class="fa fa-book"> 书单</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JAVA反射详解和优化</h1><div class="post-meta">Jul 19, 2017<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-何为反射机制"><span class="toc-number">1.</span> <span class="toc-text">1.何为反射机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-反射的应用场景"><span class="toc-number">2.</span> <span class="toc-text">2.反射的应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-反射机制相关API"><span class="toc-number">3.</span> <span class="toc-text">3.反射机制相关API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-反射机制优化"><span class="toc-number">4.</span> <span class="toc-text">4.反射机制优化</span></a></li></ol></div></div><div class="post-content"><h3 id="1-何为反射机制"><a href="#1-何为反射机制" class="headerlink" title="1.何为反射机制"></a>1.何为反射机制</h3><p>反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。<br><a id="more"></a></p>
<h3 id="2-反射的应用场景"><a href="#2-反射的应用场景" class="headerlink" title="2.反射的应用场景"></a>2.反射的应用场景</h3><ol>
<li>在运行时判断任意一个对象所属的类；</li>
<li>在运行时构造任意一个类的对象；</li>
<li>在运行时判断任意一个类所具有的成员变量和方法；</li>
<li>在运行时调用任意一个对象的方法；</li>
<li>生成动态代理；</li>
</ol>
<h3 id="3-反射机制相关API"><a href="#3-反射机制相关API" class="headerlink" title="3.反射机制相关API"></a>3.反射机制相关API</h3><ol>
<li><p>通过一个对象获得完整的包名和类名</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestReflect</span> &#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) throws Exception </span>&#123;</div><div class="line">        TestReflect testReflect = <span class="keyword">new</span> TestReflect();</div><div class="line">        System.<span class="keyword">out</span>.println(testReflect.getClass().getName());</div><div class="line">        <span class="comment">// 结果 com.gemini.test.TestReflect</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>实例化Class类对象</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestReflect &#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; class1 = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; class2 = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; class3 = <span class="keyword">null</span>;</div><div class="line">        <span class="comment">// 一般采用这种形式</span></div><div class="line">        class1 = <span class="keyword">Class</span>.forName(<span class="string">"com.gemini.test.TestReflect"</span>);</div><div class="line">        class2 = <span class="keyword">new</span> TestReflect().getClass();</div><div class="line">        class3 = TestReflect.<span class="keyword">class</span>;</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"类名称   "</span> + class1.getName());</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"类名称   "</span> + class2.getName());</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"类名称   "</span> + class3.getName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取一个对象的父类与实现的接口</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestReflect <span class="keyword">implements</span> Serializable &#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2862585049955236662</span>L;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; clazz = <span class="keyword">Class</span>.forName(<span class="string">"net.xsoftlab.baike.TestReflect"</span>);</div><div class="line">        <span class="comment">// 取得父类</span></div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; parentClass = clazz.getSuperclass();</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"clazz的父类为："</span> + parentClass.getName());</div><div class="line">        <span class="comment">// clazz的父类为： java.lang.Object</span></div><div class="line">        <span class="comment">// 获取所有的接口</span></div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; intes[] = clazz.getInterfaces();</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"clazz实现的接口有："</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; intes.length; i++) &#123;</div><div class="line">            System.out.<span class="keyword">println</span>((i + <span class="number">1</span>) + <span class="string">"："</span> + intes[i].getName());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// clazz实现的接口有：</span></div><div class="line">        <span class="comment">// 1：java.io.Serializable</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>通过反射机制实例化一个类的对象</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">import java.lang.reflect.Constructor;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestReflect</span> &#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) throws Exception </span>&#123;</div><div class="line">        Class&lt;?&gt; class1 = <span class="literal">null</span>;</div><div class="line">        class1 = Class.forName(<span class="string">"com.gemini.test.User"</span>);</div><div class="line">        <span class="comment">// 第一种方法，实例化默认构造方法，调用set赋值</span></div><div class="line">        User user = (User) class1.newInstance();</div><div class="line">        user.setAge(<span class="number">20</span>);</div><div class="line">        user.setName(<span class="string">"Rollen"</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(user); <span class="comment">// 结果 User [age=20, name=Rollen]</span></div><div class="line"></div><div class="line">        <span class="comment">// 第二种方法 取得全部的构造函数 使用构造函数赋值</span></div><div class="line">        Constructor&lt;?&gt; cons[] = class1.getConstructors();</div><div class="line">        <span class="comment">// 查看每个构造方法需要的参数</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cons.length; i++) &#123;</div><div class="line">            Class&lt;?&gt; clazzs[] = cons[i].getParameterTypes();</div><div class="line">            System.<span class="keyword">out</span>.print(<span class="string">"cons["</span> + i + <span class="string">"] ("</span>);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; clazzs.length; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (j == clazzs.length - <span class="number">1</span>)</div><div class="line">                    System.<span class="keyword">out</span>.print(clazzs[j].getName());</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    System.<span class="keyword">out</span>.print(clazzs[j].getName() + <span class="string">","</span>);</div><div class="line">            &#125;</div><div class="line">            System.<span class="keyword">out</span>.println(<span class="string">")"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 结果</span></div><div class="line">        <span class="comment">// cons[0] (java.lang.String)</span></div><div class="line">        <span class="comment">// cons[1] (int,java.lang.String)</span></div><div class="line">        <span class="comment">// cons[2] ()</span></div><div class="line">        user = (User) cons[<span class="number">0</span>].newInstance(<span class="string">"Rollen"</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(user);</div><div class="line">        <span class="comment">// 结果 User [age=0, name=Rollen]</span></div><div class="line">        user = (User) cons[<span class="number">1</span>].newInstance(<span class="number">20</span>, <span class="string">"Rollen"</span>);</div><div class="line">        System.<span class="keyword">out</span>.println(user);</div><div class="line">        <span class="comment">// 结果 User [age=20, name=Rollen]</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> <span class="title">User</span> &#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        super();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span>(<span class="params">String name</span>) </span>&#123;</div><div class="line">        super();</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span>(<span class="params"><span class="keyword">int</span> age, String name</span>) </span>&#123;</div><div class="line">        super();</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> age;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span>(<span class="params"><span class="keyword">int</span> age</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(<span class="params">String name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> String <span class="title">toString</span>(<span class="params"></span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"User [age="</span> + age + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个类的全部属性</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Field;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestReflect <span class="keyword">implements</span> Serializable &#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2862585049955236662</span>L;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> Exception &#123;</div><div class="line">        <span class="keyword">Class</span>&lt;?&gt; clazz = <span class="keyword">Class</span>.forName(<span class="string">"com.gemini.test.TestReflect"</span>);</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"===============本类属性==============="</span>);</div><div class="line">        Field[] field = clazz.getDeclaredFields(); <span class="comment">// 取得本类的全部属性</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; field.length; i++) &#123;</div><div class="line">            <span class="keyword">int</span> mo = field[i].getModifiers();<span class="comment">// 权限修饰符</span></div><div class="line">            String priv = Modifier.toString(mo);</div><div class="line">            <span class="keyword">Class</span>&lt;?&gt; type = field[i].getType();<span class="comment">// 属性类型</span></div><div class="line">            System.out.<span class="keyword">println</span>(priv + <span class="string">" "</span> + type.getName() + <span class="string">" "</span> + field[i].getName() + <span class="string">";"</span>);</div><div class="line">        &#125;</div><div class="line">        System.out.<span class="keyword">println</span>(<span class="string">"==========实现的接口或者父类的属性=========="</span>);</div><div class="line">        Field[] filed1 = clazz.getFields(); <span class="comment">// 取得实现的接口或者父类的属性</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; filed1.length; j++) &#123;</div><div class="line">            <span class="keyword">int</span> mo = filed1[j].getModifiers();<span class="comment">// 权限修饰符</span></div><div class="line">            String priv = Modifier.toString(mo);</div><div class="line">            <span class="keyword">Class</span>&lt;?&gt; type = filed1[j].getType();<span class="comment">// 属性类型</span></div><div class="line">            System.out.<span class="keyword">println</span>(priv + <span class="string">" "</span> + type.getName() + <span class="string">" "</span> + filed1[j].getName() + <span class="string">";"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个类的全部方法</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReflect</span> <span class="keyword">implements</span> <span class="title">Serializable</span> &#123;</span></div><div class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> long serialVersionUID = -<span class="number">2862585049955236662</span>L;</div><div class="line">    <span class="keyword">public</span> static void main(String[] args) throws Exception &#123;</div><div class="line">        <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">clazz</span> = <span class="title">Class</span>.<span class="title">forName</span>("<span class="title">com</span>.<span class="title">gemini</span>.<span class="title">test</span>.<span class="title">TestReflect</span>");</span></div><div class="line">        <span class="function"><span class="keyword">Method</span> <span class="title">method</span>[] =</span> clazz.getMethods();</div><div class="line">        <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="function"><span class="keyword">method</span>.<span class="title">length</span>; ++<span class="title">i</span>) &#123;</span></div><div class="line">            <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">returnType</span> = <span class="title">method</span>[<span class="title">i</span>].<span class="title">getReturnType</span>();</span></div><div class="line">            <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">para</span>[] = <span class="title">method</span>[<span class="title">i</span>].<span class="title">getParameterTypes</span>();</span></div><div class="line">            int temp = <span class="function"><span class="keyword">method</span>[<span class="title">i</span>].<span class="title">getModifiers</span>(</span>);</div><div class="line">            System.out.<span class="built_in">print</span>(Modifier.toString(temp) + <span class="string">" "</span>);</div><div class="line">            System.out.<span class="built_in">print</span>(returnType.getName() + <span class="string">"  "</span>);</div><div class="line">            System.out.<span class="built_in">print</span>(<span class="function"><span class="keyword">method</span>[<span class="title">i</span>].<span class="title">getName</span>(</span>) + <span class="string">" "</span>);</div><div class="line">            System.out.<span class="built_in">print</span>(<span class="string">"("</span>);</div><div class="line">            <span class="keyword">for</span> (int j = <span class="number">0</span>; j &lt; para.length; ++j) &#123;</div><div class="line">                System.out.<span class="built_in">print</span>(para[j].getName() + <span class="string">" "</span> + <span class="string">"arg"</span> + j);</div><div class="line">                <span class="keyword">if</span> (j &lt; para.length - <span class="number">1</span>) &#123;</div><div class="line">                    System.out.<span class="built_in">print</span>(<span class="string">","</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">exce</span>[] = <span class="title">method</span>[<span class="title">i</span>].<span class="title">getExceptionTypes</span>();</span></div><div class="line">            <span class="keyword">if</span> (exce.length &gt; <span class="number">0</span>) &#123;</div><div class="line">                System.out.<span class="built_in">print</span>(<span class="string">") throws "</span>);</div><div class="line">                <span class="keyword">for</span> (int k = <span class="number">0</span>; k &lt; exce.length; ++k) &#123;</div><div class="line">                    System.out.<span class="built_in">print</span>(exce[k].getName() + <span class="string">" "</span>);</div><div class="line">                    <span class="keyword">if</span> (k &lt; exce.length - <span class="number">1</span>) &#123;</div><div class="line">                        System.out.<span class="built_in">print</span>(<span class="string">","</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                System.out.<span class="built_in">print</span>(<span class="string">")"</span>);</div><div class="line">            &#125;</div><div class="line">            System.out.println();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>通过反射机制调用某个类的方法</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestReflect &#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) throws Exception &#123;</div><div class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">"net.xsoftlab.baike.TestReflect"</span>);</div><div class="line">        <span class="comment">// 调用TestReflect类中的reflect1方法</span></div><div class="line">        Method method = clazz.getMethod(<span class="string">"reflect1"</span>);</div><div class="line">        method.invoke(clazz.newInstance());</div><div class="line">        <span class="comment">// Java 反射机制 - 调用某个类的方法1.</span></div><div class="line">        <span class="comment">// 调用TestReflect的reflect2方法</span></div><div class="line">        method = clazz.getMethod(<span class="string">"reflect2"</span>, <span class="keyword">int</span>.<span class="keyword">class</span>, <span class="keyword">String</span>.<span class="keyword">class</span>);</div><div class="line">        method.invoke(clazz.newInstance(), <span class="number">20</span>, <span class="string">"张三"</span>);</div><div class="line">        <span class="comment">// Java 反射机制 - 调用某个类的方法2.</span></div><div class="line">        <span class="comment">// age -&gt; 20. name -&gt; 张三</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> reflect1() &#123;</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Java 反射机制 - 调用某个类的方法1."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> reflect2(<span class="keyword">int</span> age, <span class="keyword">String</span> name) &#123;</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Java 反射机制 - 调用某个类的方法2."</span>);</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"age -&gt; "</span> + age + <span class="string">". name -&gt; "</span> + name);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>通过反射机制操作某个类的属性</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect.Field;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReflect</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">String</span> proprety = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) throws Exception &#123;</div><div class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">"net.xsoftlab.baike.TestReflect"</span>);</div><div class="line">        Object obj = clazz.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line">        <span class="comment">// 可以直接对 private 的属性赋值</span></div><div class="line">        Field field = clazz.getDeclaredField(<span class="string">"proprety"</span>);</div><div class="line">        field.setAccessible(<span class="literal">true</span>);</div><div class="line">        field.<span class="keyword">set</span>(obj, <span class="string">"Java反射机制"</span>);</div><div class="line">        System.out.println(field.<span class="keyword">get</span>(obj));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>反射机制的动态代理</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取类加载器的方法</span></div><div class="line">TestReflect testReflect = <span class="keyword">new</span> <span class="type">TestReflect</span>();</div><div class="line">        System.out.println(<span class="string">"类加载器  "</span> + testReflect.getClass().getClassLoader().getClass().getName());</div><div class="line"><span class="keyword">package</span> com.gemini.test;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</div><div class="line"><span class="comment">//定义项目接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> say(<span class="keyword">String</span> name, int age);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义真实项目</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Subject</span></span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> say(<span class="keyword">String</span> name, int age) &#123;</div><div class="line">        <span class="keyword">return</span> name + <span class="string">"  "</span> + age;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">InvocationHandler</span></span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Object obj = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">public</span> Object bind(Object obj) &#123;</div><div class="line">        <span class="built_in">this</span>.obj = obj;</div><div class="line">        <span class="keyword">return</span> Proxy.<span class="keyword">new</span><span class="type">ProxyInstance</span>(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(), <span class="built_in">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</div><div class="line">        Object temp = method.invoke(<span class="built_in">this</span>.obj, args);</div><div class="line">        <span class="keyword">return</span> temp;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 在java中有三种类类加载器。</div><div class="line"> *</div><div class="line"> * 1）Bootstrap ClassLoader 此加载器采用c++编写，一般开发中很少见。</div><div class="line"> *</div><div class="line"> * 2）Extension ClassLoader 用来进行扩展类的加载，一般对应的是jrelibext目录中的类</div><div class="line"> *</div><div class="line"> * 3）AppClassLoader 加载classpath指定的类，是最常用的加载器。同时也是java中默认的加载器。</div><div class="line"> *</div><div class="line"> * 如果想要完成动态代理，首先需要定义一个InvocationHandler接口的子类，已完成代理的具体操作。</div><div class="line"> *</div><div class="line"> * @author xsoftlab.net</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReflect</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) throws Exception &#123;</div><div class="line">        MyInvocationHandler demo = <span class="keyword">new</span> <span class="type">MyInvocationHandler</span>();</div><div class="line">        Subject sub = (Subject) demo.bind(<span class="keyword">new</span> <span class="type">RealSubject</span>());</div><div class="line">        <span class="keyword">String</span> info = sub.say(<span class="string">"Rollen"</span>, <span class="number">20</span>);</div><div class="line">        System.out.println(info);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>将反射机制应用于工厂模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">fruit</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Apple</span> <span class="keyword">implements</span> <span class="title">fruit</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Apple"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Orange</span> <span class="keyword">implements</span> <span class="title">fruit</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Orange"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> fruit <span class="title">getInstance</span><span class="params">(String ClassName)</span> </span>&#123;</div><div class="line">        fruit f = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            f = (fruit) Class.forName(ClassName).newInstance();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> f;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 对于普通的工厂模式当我们在添加一个子类的时候，就需要对应的修改工厂类。 当我们添加很多的子类的时候，会很麻烦。</div><div class="line"> * Java 工厂模式可以参考</div><div class="line"> * http://baike.xsoftlab.net/view/java-factory-pattern</div><div class="line"> *</div><div class="line"> * 现在我们利用反射机制实现工厂模式，可以在不修改工厂类的情况下添加任意多个子类。</div><div class="line"> * 但是有一点仍然很麻烦，就是需要知道完整的包名和类名，这里可以使用properties配置文件来完成。</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReflect</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        fruit f = Factory.getInstance(<span class="string">"com.gemini.test.Apple"</span>);</div><div class="line">        <span class="keyword">if</span> (f != <span class="keyword">null</span>) &#123;</div><div class="line">            f.eat();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-反射机制优化"><a href="#4-反射机制优化" class="headerlink" title="4.反射机制优化"></a>4.反射机制优化</h3><ol>
<li>描述<br>从事java开发的都知道反射的运行速度慢，所以很多java的开发者都对反射机制的使用望而却步(包括BME组件SDO)。我想知道，究竟反射机制慢在哪里？有没有改进方法，让我们可以继续使用它？如果一个好东西因为其自身的一些缺陷而不使用它，那么实在可惜，反射也是这样。我想说的是：我们应该一点点的改进它。</li>
<li>错误的使用方法<br>错误的使用方法是每次需要获取Class的对象时都使用Class.forName方法，或者需要调用Class对象上的方法时都调用getDeclaredMethod(String name, Class&lt;?&gt;… parameterTypes)或getMethod(String name, Class&lt;?&gt;… parameterTypes)方法获取Method对象，再调用其上的invoke(Object obj, Object… args)方法。<br>这里存在两个容易造成性能损耗的地方：<br>Class.forName方法的调用会执行Class类文件在整个类路径下的搜索，频繁调用比较影响性能。<br>Class对象上的getDeclaredMethod (String, Class&lt;?&gt;…)或getMethod(String, Class&lt;?&gt;…)方法的调用会执行Method对象在Class对象上的搜索。有些同事还使用getMethods()方法获取Method数组，然后执行搜索任务，实际上getMethods()还会执行方法对象的集体Copy比直接使用(String, Class&lt;?&gt;…)或getMethod(String, Class&lt;?&gt;…)方法还要消耗时间及空间。</li>
<li>Cache思想<br>Cache的思想是将需要的反射中间件给存储下来，以便以后使用。不管使用什么方法获取Class对象上的Method对象，返回的都是Method对象的copy对象。这些copy对象有的只是使用一次就被回收了，未免有些可惜。我们可这以将这些对象给缓存下来，以便以后使用。而在存储数据结构中，无疑HashMap的查找速度是最快的，它主要是通过对象的Hash码进行一次查找，速度超快。但是HashMap上的操作不是线程安全的，需要改进方法实现同步。</li>
<li>具体实现<br>需要两个组件ClassInfo和ReflectionCache。<br>ClassInfo主要保存Class对象的信息，主要是方法Map。其中ClassInfo中包括三部分方法的Map: Getter, Setter, Other。Getter是Class的属性的获取方法，Setter是Class的属性的设置方法，Other是其它方法。需要注意的是Getter和Setter的方法需要完全符合Javabean规范(isXXX方法属于Getter方法范围内)，其key值是方法对应的属性名。Other方法是除Getter和Setter以外的其它方法。<br>ReflectionCache组件主要是通过HashMap对ClassInfo进行缓存。缓存的键值是ClassInfo中Class对象的全称。如一个String对象，它缓存的键值就是java.lang.String。并且ReflectionCache提供了几种不同get和put方法来方便用户的操作。<br>另外ClassInfo的生成需要用到ClassInfoUtils工具。它的主要工作是创建ClassInfo对象，其中创建ClassInfo时可以提供Method Type信息来指定缓存的方法类型（如：所有方法-All、存取器方法-Access、获取方法-Getter和设置方法-Setter）。</li>
<li>同步控制<br>ReflectionCache中ClassInfoMap是一个静变量，那么随之而来的就是HashMap的同步问题。我对ReflectionCache的做了些改进，主要是对put方法的处理。首先HashMap的获取操作（get操作）没有加入同步操作，因此获取的操作是可以并发的。现在的问题在于如果获取不了ClassInfo对象时会要执行设置操作（set操作），此时并发问题随之而来。可能在同一时刻会有很多线程去设置ClassInfo，在第一个设置完ClassInfo的线程结束后，第二个线程应该停止设置ClassInfo。在此需求之上，我们需要对ReflectionCache的put操作上加上同步块，并且让put操作再执行一个额外的操作：返回添加到ClassInfoMap中的ClassInfo，不管它是不是其它线程添加的。因此我们在设置ClassInfo时，可以这样操作：<br>ClassInfo classInfo = ReflectionCache.putClassInfo(String.class);</li>
<li>改进效率<br>改进之后的效率的提高是明显的。主要是节省了中间变量创建及反射数据的查找时间。测试数据:<br>100000次，20个线程，无Class.forName操作<br>一般用法: 11375 milliseconds<br>ReflectionCache: 2562 milliseconds<br>100000次，20个线程，有Class.forName操作<br>一般用法: 16125 milliseconds<br>ReflectionCache: 4187 milliseconds<br>可见使用ReflectionCache明显提高了效率。</li>
</ol>
<p>伪代码如下：<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>.默认方式</div><div class="line">Class clazz = Class.forName(<span class="string">"com.dianping.csc.page_config.view.entity.ViewConfig"</span>)<span class="comment">;</span></div><div class="line">clazz.newInstance()<span class="comment">;</span></div><div class="line"><span class="number">2</span>.<span class="keyword">Cache加载Class</span></div><div class="line"><span class="keyword">CachedClass </span>classInfo = ReflectionCache.getCachedClass(ViewConfig.class)<span class="comment">;</span></div><div class="line">Class clazz = classInfo.getTheClass()<span class="comment">;</span></div><div class="line"><span class="number">3</span>.<span class="keyword">Cache加载Method</span></div><div class="line">MethodAccess methodAccess = MethodAccess.get(classInfo.getTheClass())<span class="comment">;</span></div><div class="line">methodAccess.invoke()<span class="comment">;</span></div><div class="line">clazz.newInstance()<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>引用用包如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.groovy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>groovy-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.esotericsoftware<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reflectasm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>程序示例：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment"><span class="markdown">/**</span></span></div><div class="line"> *根据Body字符串，自动封装</div><div class="line"> * @param issueBody</div><div class="line"> * @param obj</div><div class="line"> * @return</div><div class="line"> * @throws CscConfigException</div><div class="line"> */</div><div class="line">public <span class="keyword">static</span> <span class="built_in">Object</span> setJavaBeanByRequestBody(<span class="built_in">String</span> issueBody, <span class="built_in">Object</span> obj) throws CscConfigException &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        JsonParser jsonParser = <span class="keyword">new</span> JsonParser();</div><div class="line"> JsonObject jsonObject = jsonParser.parse(issueBody).getAsJsonObject();</div><div class="line"> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; map = ObjectUtil.getObjectPro(obj.getClass());</div><div class="line"> <span class="built_in">Set</span>&lt;<span class="built_in">Map</span>.Entry&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;&gt; mapping = map.entrySet();</div><div class="line"> MethodAccess methodAccess = MethodAccess.<span class="keyword">get</span>(obj.getClass());</div><div class="line"> <span class="keyword">for</span> (<span class="built_in">Map</span>.Entry&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; me : mapping) &#123;</div><div class="line">            <span class="built_in">String</span> name = me.getKey();</div><div class="line"> <span class="built_in">String</span> type = me.getValue();</div><div class="line"> <span class="keyword">try</span>&#123;</div><div class="line">                <span class="built_in">int</span> index_ = methodAccess.getIndex(<span class="string">"set"</span> + StringUtil.toFirstUp(name));</div><div class="line"> <span class="keyword">if</span> (type.contains(<span class="string">"String"</span>)) &#123;</div><div class="line">                    <span class="keyword">if</span> (jsonObject.<span class="keyword">get</span>(name) != <span class="keyword">null</span>) &#123;</div><div class="line">                        <span class="built_in">String</span> setValue = <span class="string">""</span>;</div><div class="line"> <span class="keyword">try</span>&#123;</div><div class="line">                            setValue = jsonObject.<span class="keyword">get</span>(name).getAsString();</div><div class="line"> &#125;<span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">                            setValue = jsonObject.<span class="keyword">get</span>(name).toString();</div><div class="line"> &#125;</div><div class="line">                        <span class="keyword">if</span> (setValue == <span class="keyword">null</span>) &#123;</div><div class="line">                            setValue = <span class="string">""</span>;</div><div class="line"> &#125;</div><div class="line">                        setValue = setValue.replace(<span class="string">"&amp;quot;"</span>, <span class="string">""</span>).replace(<span class="string">"&amp;nbsp;"</span>, <span class="string">""</span>);</div><div class="line"> methodAccess.invoke(obj,index_,setValue);</div><div class="line"> &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.contains(<span class="string">"Long"</span>)) &#123;</div><div class="line">                    <span class="keyword">if</span> (jsonObject.<span class="keyword">get</span>(name) != <span class="keyword">null</span>) &#123;</div><div class="line">                        methodAccess.invoke(obj,index_,jsonObject.<span class="keyword">get</span>(name).getAsLong());</div><div class="line"> &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.contains(<span class="string">"Date"</span>)) &#123;</div><div class="line">                    <span class="keyword">if</span> (jsonObject.<span class="keyword">get</span>(name) != <span class="keyword">null</span>) &#123;</div><div class="line">                        DateFormat dateformat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line"> Date date = dateformat.parse(jsonObject.<span class="keyword">get</span>(name).toString());</div><div class="line"></div><div class="line"> &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.contains(<span class="string">"Integer"</span>)) &#123;</div><div class="line">                    <span class="keyword">if</span> (jsonObject.<span class="keyword">get</span>(name) != <span class="keyword">null</span>) &#123;</div><div class="line">                        methodAccess.invoke(obj,index_,jsonObject.<span class="keyword">get</span>(name).getAsInt());</div><div class="line"> &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                &#125;</div><div class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> CscConfigException(<span class="number">100001</span>,<span class="string">"信息获取异常"</span>);</div><div class="line"> &#125;</div><div class="line">    <span class="keyword">return</span> obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://jasonlife.top/2017/07/19/14JAVA反射详解和优化/" data-id="cjpv4tc9c0003a7xwkyak16sq" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Java/">Java</a></div><div class="post-nav"><a href="/2017/07/21/15Java编程实战知识点/" class="pre">Java编程实战知识点</a><a href="/2017/07/19/13常见Jar包简介/" class="next">常见Jar包简介</a></div><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>此文有用? 求鼓励!<br></div></div><div id="donate_guide" class="donate_bar center hidden"><img src="https://thumbnail0.baidupcs.com/thumbnail/5d04e9dfd09f4c3f1efb1b0dc11e7639?fid=51316594-250528-101240699237702&amp;time=1543392000&amp;rt=sh&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ocx7cJWWb55FXbjH%2B%2Fk3No1KMVc%3D&amp;expires=8h&amp;chkv=0&amp;chkbd=0&amp;chkpc=&amp;dp-logid=7692443322322337931&amp;dp-callid=0&amp;size=c710_u400&amp;quality=100&amp;vuk=-&amp;ft=video" title="微信打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://jasonlife.top"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Book/">Book</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Guava/">Guava</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Temp/">Temp</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客技术/">博客技术</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/缓存/">缓存</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/职业规划/">职业规划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/Temp/" style="font-size: 15px;">Temp</a> <a href="/tags/面试-Java/" style="font-size: 15px;">面试 Java</a> <a href="/tags/Java-JVM-虚拟机/" style="font-size: 15px;">Java JVM 虚拟机</a> <a href="/tags/Java-专业术语/" style="font-size: 15px;">Java 专业术语</a> <a href="/tags/Java-Paxos-Zookeeper/" style="font-size: 15px;">Java Paxos Zookeeper</a> <a href="/tags/Java-Guava/" style="font-size: 15px;">Java Guava</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Book/" style="font-size: 15px;">Book</a> <a href="/tags/Tech/" style="font-size: 15px;">Tech</a> <a href="/tags/缓存-架构/" style="font-size: 15px;">缓存 架构</a> <a href="/tags/Paxos/" style="font-size: 15px;">Paxos</a> <a href="/tags/Java-对比/" style="font-size: 15px;">Java 对比</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Java-面试/" style="font-size: 15px;">Java 面试</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/32java-web会话管理/">java web会话管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/31git-ignore/">git ignore 文件解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/30/30IntegerCache-ByteCache-CharacterCache-LongCache-ShortCache/">IntegerCache ByteCache CharacterCache LongCache ShortCache</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/13/29ni真的了解TCP三次握手么？/">ni真的了解TCP三次握手么？</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/28POM文件详解/">POM文件详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/27/27web-xml详解/">web.xml详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/26Java面试题/">Java面试题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/12/25高并发服务设计——缓存/">高并发服务设计——缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/12/24大型网站系统与Java中间件实战/">大型网站系统与Java中间件实战</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/12/23RPC框架学习/">RPC框架学习</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.jianshu.com/u/90ab66c248e6" title="占小狼" target="_blank">占小狼</a><ul></ul><a href="http://calvin1978.blogcn.com/" title="江南白衣" target="_blank">江南白衣</a><ul></ul><a href="http://coolshell.cn/" title="酷壳" target="_blank">酷壳</a><ul></ul><a href="http://colobu.com/" title="鸟窝" target="_blank">鸟窝</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Jason的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?10423309";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>